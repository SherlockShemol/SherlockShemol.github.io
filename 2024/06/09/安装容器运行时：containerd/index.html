<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author"><title>安装容器运行时：containerd · Shemol's Blog</title><meta name="description" content="我们要先安装containerd，然后安装k8s，接着部署kubeedge、edgemesh以及sedna，跑一个官方示例的联合推理的应用案例。

实验环境：Debian GNU&amp;#x2F;Linux 12 (bookworm) x86_64，提前配置好了代理和apt镜像源，配置好代理方便从gith"><meta name="og:description" content="我们要先安装containerd，然后安装k8s，接着部署kubeedge、edgemesh以及sedna，跑一个官方示例的联合推理的应用案例。

实验环境：Debian GNU&amp;#x2F;Linux 12 (bookworm) x86_64，提前配置好了代理和apt镜像源，配置好代理方便从gith"><meta name="twitter:site" content="Shemol's Blog"><meta name="twitter:title" content="安装容器运行时：containerd"><meta name="twitter:card" content="summary"><meta name="keywords" content=""><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 7.3.0"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><div class="container" id="stage"><div class="row"><div class="col-sm-3 col-xs-12 side-container invisible" id="side-bar"><div class="vertical-text site-title"><h3 class="site-title-small" tabindex="-1"><a class="a-title" href="/">Shemol's Blog</a></h3><h1 class="site-title-large" tabindex="-1"><a class="a-title" href="/"></a></h1><!--h6(onclick="triggerSiteNav()") Trigger--></div><br class="visible-lg visible-md visible-sm"><div class="site-title-links" id="site-nav"><ul><li><a href="/">Home</a></li><li><a href="/archives">Archive</a></li><li><a href="/tags">Tags</a></li><li><a href="/friends/index.html">friends</a></li><li><a href="/about/index.html">about</a></li><li class="soc"></li></ul><div class="visible-lg visible-md visible-sm site-nav-footer"><br class="site-nav-footer-br"><footer><p>&copy;&nbsp;2024&nbsp;<a target="_blank" href="https://shemol.tech" rel="noopener noreferrer">Shemol</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div><div class="col-sm-9 col-xs-12 main-container invisible" id="main-container"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post-container"><p class="post-title"><a>安装容器运行时：containerd</a></p><p class="post-meta"><span class="date meta-item">Posted at&nbsp;2024-06-09</span><span class="meta-item"><i class="fa fa-tag"></i><span>&nbsp;</span><a class="a-tag" href="/tags/流程记录/" title="流程记录">流程记录</a><span>&nbsp;</span></span></p><p class="post-abstract"><span id="more"></span>
<p>我们要先安装containerd，然后安装k8s，接着部署kubeedge、edgemesh以及sedna，跑一个官方示例的联合推理的应用案例。</p>
<blockquote>
<p>实验环境：Debian GNU&#x2F;Linux 12 (bookworm) x86_64，提前配置好了代理和apt镜像源，配置好代理方便从github上下载文件。<br>一点可能有用的建议：在进行分区时尽量将&#x2F;var分区分配空间多一点（至少20G），&#x2F;var是存放镜像和日志的地方。</p>
</blockquote>
<h1 id="安装containerd"><a href="#安装containerd" class="headerlink" title="安装containerd"></a>安装containerd</h1><p>官方安装文档：<a target="_blank" rel="noopener" href="https://github.com/containerd/containerd/blob/main/docs/getting-started.md">https://github.com/containerd/containerd/blob/main/docs/getting-started.md</a></p>
<h2 id="安装containerd-1"><a href="#安装containerd-1" class="headerlink" title="安装containerd"></a>安装containerd</h2><p>1.下载containerd并安装到指定路径</p>
<figure class="highlight bash"><table><tr><td class="code"><pre class="line-numbers language-hljs bash">wget -c https://github.com/containerd/containerd/releases/download/v1.7.18/containerd-1.7.18-linux-amd64.tar.gz<br><br><span class="hljs-built_in"><code class="language-hljs bash">wget -c https://github.com/containerd/containerd/releases/download/v1.7.18/containerd-1.7.18-linux-amd64.tar.gz<br><br><span class="hljs-built_in">sudo</span> tar Cxzvf /usr/local/bin/ containerd-1.7.18-linux-amd64.tar.gz<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>
<p>2.通过systemd启动containerd</p>
<figure class="highlight bash"><table><tr><td class="code"><pre class="line-numbers language-hljs bash">wget -c https://raw.githubusercontent.com/containerd/containerd/main/containerd.service<br><br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mkdir</span> -p /usr/local/lib/systemd/system/<br><br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">cp</span> containerd.service /usr/local/lib/systemd/system/<br><br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> 755 /usr/local/lib/systemd/system/containerd.service<br><br><span class="hljs-built_in">sudo</span> systemctl daemon-reload<br><br><span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in"><code class="language-hljs bash">wget -c https://raw.githubusercontent.com/containerd/containerd/main/containerd.service<br><br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mkdir</span> -p /usr/local/lib/systemd/system/<br><br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">cp</span> containerd.service /usr/local/lib/systemd/system/<br><br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> 755 /usr/local/lib/systemd/system/containerd.service<br><br><span class="hljs-built_in">sudo</span> systemctl daemon-reload<br><br><span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> --now containerd<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>
<p>3.配置containerd<br>获取默认配置内容</p>
<figure class="highlight bash"><table><tr><td class="code"><pre class="line-numbers language-hljs bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mkdir</span> -p /etc/containerd/<br><br>containerd config default | <span class="hljs-built_in">sudo</span> <span class="hljs-built_in"><code class="language-hljs bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mkdir</span> -p /etc/containerd/<br><br>containerd config default | <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">tee</span> /etc/containerd/config.toml<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>
<p>（1）修改<code>config.toml</code>中的<code>sandbox_image</code>（可选），<code>systemd_cgroup</code>，<code>SystemdCgroup</code>等属性：</p>
<figure class="highlight toml"><table><tr><td class="code"><pre class="line-numbers language-hljs toml"><span class="hljs-comment"># 将 sandbox_image = &quot;registry.k8s.io/pause:3.6&quot; 调整为 </span><br><span class="hljs-attr">sandbox_image</span> = <span class="hljs-string">&quot;registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.9&quot;</span> <br><br><span class="hljs-comment"># 将 [plugins.&quot;io.containerd.grpc.v1.cri&quot;] 下的 systemd_cgroup = false 注释掉 </span><br><span class="hljs-comment"># systemd_cgroup = false </span><br><br><span class="hljs-comment"># 将 [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options] 下的 SystemdCgroup = false 调整为 true </span><br><span class="hljs-attr">SystemdCgroup</span> = <span class="hljs-literal"><code class="language-hljs toml"><span class="hljs-comment"># 将 sandbox_image = &quot;registry.k8s.io/pause:3.6&quot; 调整为 </span><br><span class="hljs-attr">sandbox_image</span> = <span class="hljs-string">&quot;registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.9&quot;</span> <br><br><span class="hljs-comment"># 将 [plugins.&quot;io.containerd.grpc.v1.cri&quot;] 下的 systemd_cgroup = false 注释掉 </span><br><span class="hljs-comment"># systemd_cgroup = false </span><br><br><span class="hljs-comment"># 将 [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options] 下的 SystemdCgroup = false 调整为 true </span><br><span class="hljs-attr">SystemdCgroup</span> = <span class="hljs-literal">true</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>
<p>这里sandbox_image版本变成3.8是根据Kubernetes的版本来的（如果不是安装Kubernetes，可以不用修改）：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre class="line-numbers language-hljs bash"><span class="hljs-built_in"><code class="language-hljs bash"><span class="hljs-built_in">sudo</span> kubeadm config images list --kubernetes-version v1.28.10<br>registry.k8s.io/kube-apiserver:v1.28.10<br>registry.k8s.io/kube-controller-manager:v1.28.10<br>registry.k8s.io/kube-scheduler:v1.28.10<br>registry.k8s.io/kube-proxy:v1.28.10<br>registry.k8s.io/pause:3.9<br>registry.k8s.io/etcd:3.5.12-0<br>registry.k8s.io/coredns/coredns:v1.10.1<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>
<p>（2）另外，如果从本地私有仓库拉取镜像，可能会遇到如下错误：<code>Unable to pull image from insecure registry, http: server gave HTTP response to HTTPS client</code>，为此我们需要对这个私有仓库（比如这里的 <code>http://192.168.10.127:5000</code>）进行安全设置：（这个笔者没有遇到这个问题，但考虑到可能有读者会遇到，还是从参考文章中复制了下来）</p>
<figure class="highlight toml"><table><tr><td class="code"><pre class="line-numbers language-hljs toml"><span class="hljs-comment"># 在 [plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry] 下对 mirrors 和 mirrors 做如下配置</span><br><span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors]</span><br>  <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;192.168.10.127:5000&quot;]</span><br>    <span class="hljs-attr">endpoint</span> = [<span class="hljs-string">&quot;https://192.168.10.127:5000&quot;</span>, <span class="hljs-string">&quot;http://192.168.10.127:5000&quot;</span>]<br><span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.configs]</span><br>  <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.configs.&quot;192.168.10.127:5000&quot;.tls]</span>     <span class="hljs-attr">insecure_skip_verify</span> = <span class="hljs-literal"><code class="language-hljs toml"><span class="hljs-comment"># 在 [plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry] 下对 mirrors 和 mirrors 做如下配置</span><br><span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors]</span><br>  <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;192.168.10.127:5000&quot;]</span><br>    <span class="hljs-attr">endpoint</span> = [<span class="hljs-string">&quot;https://192.168.10.127:5000&quot;</span>, <span class="hljs-string">&quot;http://192.168.10.127:5000&quot;</span>]<br><span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.configs]</span><br>  <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.configs.&quot;192.168.10.127:5000&quot;.tls]</span>     <span class="hljs-attr">insecure_skip_verify</span> = <span class="hljs-literal">true</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>
<p>注意空格。<br>（3）个人建议添加国内镜像源方便镜像拉取。<br>阿里云镜像加速：<a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</a><br>华为云镜像加速：容器-&gt;容器镜像服务SWR-&gt;镜像资源-&gt;镜像中心-&gt;镜像加速器</p>
<figure class="highlight toml"><table><tr><td class="code"><pre class="line-numbers language-hljs toml"><span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors]</span> <span class="hljs-comment">#主要在这下面配置镜像加速服务</span><br>  <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;docker.io&quot;]</span><br>    <span class="hljs-attr">endpoint</span>=[<span class="hljs-string">&quot;https://****.mirror.aliyuncs.com&quot;</span>,<span class="hljs-string">&quot;https://****.mirror.swr.myhuaweicloud.com&quot;</span>]<br>  <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;registry.k8s.io&quot;]</span><br>    <span class="hljs-attr">endpoint</span>=[<span class="hljs-string">&quot;https://****.mirror.aliyuncs.com&quot;</span>,<span class="hljs-string">&quot;https://****.mirror.swr.myhuaweicloud.com&quot;</span>]<br>  <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;192.168.10.127:5000&quot;]</span><br>    <span class="hljs-attr">endpoint</span> = [<span class="hljs-string">&quot;https://192.168.10.127:5000&quot;</span>, <span class="hljs-string"><code class="language-hljs toml"><span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors]</span> <span class="hljs-comment">#主要在这下面配置镜像加速服务</span><br>  <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;docker.io&quot;]</span><br>    <span class="hljs-attr">endpoint</span>=[<span class="hljs-string">&quot;https://****.mirror.aliyuncs.com&quot;</span>,<span class="hljs-string">&quot;https://****.mirror.swr.myhuaweicloud.com&quot;</span>]<br>  <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;registry.k8s.io&quot;]</span><br>    <span class="hljs-attr">endpoint</span>=[<span class="hljs-string">&quot;https://****.mirror.aliyuncs.com&quot;</span>,<span class="hljs-string">&quot;https://****.mirror.swr.myhuaweicloud.com&quot;</span>]<br>  <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;192.168.10.127:5000&quot;]</span><br>    <span class="hljs-attr">endpoint</span> = [<span class="hljs-string">&quot;https://192.168.10.127:5000&quot;</span>, <span class="hljs-string">"http://192.168.10.127:5000"</span>]<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>
<p>修改后的样例（记得把镜像加速的地址改成自己的）：</p>
<figure class="highlight toml"><table><tr><td class="code"><pre class="line-numbers language-hljs toml"><span class="hljs-attr">disabled_plugins</span> = []<br><span class="hljs-attr">imports</span> = []<br><span class="hljs-attr">oom_score</span> = <span class="hljs-number">0</span><br><span class="hljs-attr">plugin_dir</span> = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attr">required_plugins</span> = []<br><span class="hljs-attr">root</span> = <span class="hljs-string">&quot;/var/lib/containerd&quot;</span><br><span class="hljs-attr">state</span> = <span class="hljs-string">&quot;/run/containerd&quot;</span><br><span class="hljs-attr">temp</span> = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attr">version</span> = <span class="hljs-number">2</span><br><br><span class="hljs-section">[cgroup]</span><br>  <span class="hljs-attr">path</span> = <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-section">[debug]</span><br>  <span class="hljs-attr">address</span> = <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">format</span> = <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">gid</span> = <span class="hljs-number">0</span><br>  <span class="hljs-attr">level</span> = <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">uid</span> = <span class="hljs-number">0</span><br><br><span class="hljs-section">[grpc]</span><br>  <span class="hljs-attr">address</span> = <span class="hljs-string">&quot;/run/containerd/containerd.sock&quot;</span><br>  <span class="hljs-attr">gid</span> = <span class="hljs-number">0</span><br>  <span class="hljs-attr">max_recv_message_size</span> = <span class="hljs-number">16777216</span><br>  <span class="hljs-attr">max_send_message_size</span> = <span class="hljs-number">16777216</span><br>  <span class="hljs-attr">tcp_address</span> = <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">tcp_tls_ca</span> = <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">tcp_tls_cert</span> = <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">tcp_tls_key</span> = <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">uid</span> = <span class="hljs-number">0</span><br><br><span class="hljs-section">[metrics]</span><br>  <span class="hljs-attr">address</span> = <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">grpc_histogram</span> = <span class="hljs-literal">false</span><br><br><span class="hljs-section">[plugins]</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.gc.v1.scheduler&quot;]</span><br>    <span class="hljs-attr">deletion_threshold</span> = <span class="hljs-number">0</span><br>    <span class="hljs-attr">mutation_threshold</span> = <span class="hljs-number">100</span><br>    <span class="hljs-attr">pause_threshold</span> = <span class="hljs-number">0.02</span><br>    <span class="hljs-attr">schedule_delay</span> = <span class="hljs-string">&quot;0s&quot;</span><br>    <span class="hljs-attr">startup_delay</span> = <span class="hljs-string">&quot;100ms&quot;</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;]</span><br>    <span class="hljs-attr">device_ownership_from_security_context</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">disable_apparmor</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">disable_cgroup</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">disable_hugetlb_controller</span> = <span class="hljs-literal">true</span><br>    <span class="hljs-attr">disable_proc_mount</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">disable_tcp_service</span> = <span class="hljs-literal">true</span><br>    <span class="hljs-attr">enable_selinux</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">enable_tls_streaming</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">enable_unprivileged_icmp</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">enable_unprivileged_ports</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">ignore_image_defined_volumes</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">max_concurrent_downloads</span> = <span class="hljs-number">3</span><br>    <span class="hljs-attr">max_container_log_line_size</span> = <span class="hljs-number">16384</span><br>    <span class="hljs-attr">netns_mounts_under_state_dir</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">restrict_oom_score_adj</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">sandbox_image</span> = <span class="hljs-string">&quot;registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.9&quot;</span><br>    <span class="hljs-attr">selinux_category_range</span> = <span class="hljs-number">1024</span><br>    <span class="hljs-attr">stats_collect_period</span> = <span class="hljs-number">10</span><br>    <span class="hljs-attr">stream_idle_timeout</span> = <span class="hljs-string">&quot;4h0m0s&quot;</span><br>    <span class="hljs-attr">stream_server_address</span> = <span class="hljs-string">&quot;127.0.0.1&quot;</span><br>    <span class="hljs-attr">stream_server_port</span> = <span class="hljs-string">&quot;0&quot;</span><br>    <span class="hljs-comment">#systemd_cgroup = false</span><br>    <span class="hljs-attr">tolerate_missing_hugetlb_controller</span> = <span class="hljs-literal">true</span><br>    <span class="hljs-attr">unset_seccomp_profile</span> = <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.cni]</span><br>      <span class="hljs-attr">bin_dir</span> = <span class="hljs-string">&quot;/opt/cni/bin&quot;</span><br>      <span class="hljs-attr">conf_dir</span> = <span class="hljs-string">&quot;/etc/cni/net.d&quot;</span><br>      <span class="hljs-attr">conf_template</span> = <span class="hljs-string">&quot;&quot;</span><br>      <span class="hljs-attr">ip_pref</span> = <span class="hljs-string">&quot;&quot;</span><br>      <span class="hljs-attr">max_conf_num</span> = <span class="hljs-number">1</span><br><br>    <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd]</span><br>      <span class="hljs-attr">default_runtime_name</span> = <span class="hljs-string">&quot;runc&quot;</span><br>      <span class="hljs-attr">disable_snapshot_annotations</span> = <span class="hljs-literal">true</span><br>      <span class="hljs-attr">discard_unpacked_layers</span> = <span class="hljs-literal">false</span><br>      <span class="hljs-attr">ignore_rdt_not_enabled_errors</span> = <span class="hljs-literal">false</span><br>      <span class="hljs-attr">no_pivot</span> = <span class="hljs-literal">false</span><br>      <span class="hljs-attr">snapshotter</span> = <span class="hljs-string">&quot;overlayfs&quot;</span><br><br>      <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.default_runtime]</span><br>        <span class="hljs-attr">base_runtime_spec</span> = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">cni_conf_dir</span> = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">cni_max_conf_num</span> = <span class="hljs-number">0</span><br>        <span class="hljs-attr">container_annotations</span> = []<br>        <span class="hljs-attr">pod_annotations</span> = []<br>        <span class="hljs-attr">privileged_without_host_devices</span> = <span class="hljs-literal">false</span><br>        <span class="hljs-attr">runtime_engine</span> = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">runtime_path</span> = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">runtime_root</span> = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">runtime_type</span> = <span class="hljs-string">&quot;&quot;</span><br><br>        <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.default_runtime.options]</span><br><br>      <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes]</span><br><br>        <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc]</span><br>          <span class="hljs-attr">base_runtime_spec</span> = <span class="hljs-string">&quot;&quot;</span><br>          <span class="hljs-attr">cni_conf_dir</span> = <span class="hljs-string">&quot;&quot;</span><br>          <span class="hljs-attr">cni_max_conf_num</span> = <span class="hljs-number">0</span><br>          <span class="hljs-attr">container_annotations</span> = []<br>          <span class="hljs-attr">pod_annotations</span> = []<br>          <span class="hljs-attr">privileged_without_host_devices</span> = <span class="hljs-literal">false</span><br>          <span class="hljs-attr">runtime_engine</span> = <span class="hljs-string">&quot;&quot;</span><br>          <span class="hljs-attr">runtime_path</span> = <span class="hljs-string">&quot;&quot;</span><br>          <span class="hljs-attr">runtime_root</span> = <span class="hljs-string">&quot;&quot;</span><br>          <span class="hljs-attr">runtime_type</span> = <span class="hljs-string">&quot;io.containerd.runc.v2&quot;</span><br><br>          <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options]</span><br>            <span class="hljs-attr">BinaryName</span> = <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-attr">CriuImagePath</span> = <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-attr">CriuPath</span> = <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-attr">CriuWorkPath</span> = <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-attr">IoGid</span> = <span class="hljs-number">0</span><br>            <span class="hljs-attr">IoUid</span> = <span class="hljs-number">0</span><br>            <span class="hljs-attr">NoNewKeyring</span> = <span class="hljs-literal">false</span><br>            <span class="hljs-attr">NoPivotRoot</span> = <span class="hljs-literal">false</span><br>            <span class="hljs-attr">Root</span> = <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-attr">ShimCgroup</span> = <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-attr">SystemdCgroup</span> = <span class="hljs-literal">true</span><br><br>      <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.untrusted_workload_runtime]</span><br>        <span class="hljs-attr">base_runtime_spec</span> = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">cni_conf_dir</span> = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">cni_max_conf_num</span> = <span class="hljs-number">0</span><br>        <span class="hljs-attr">container_annotations</span> = []<br>        <span class="hljs-attr">pod_annotations</span> = []<br>        <span class="hljs-attr">privileged_without_host_devices</span> = <span class="hljs-literal">false</span><br>        <span class="hljs-attr">runtime_engine</span> = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">runtime_path</span> = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">runtime_root</span> = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">runtime_type</span> = <span class="hljs-string">&quot;&quot;</span><br><br>        <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.untrusted_workload_runtime.options]</span><br><br>    <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.image_decryption]</span><br>      <span class="hljs-attr">key_model</span> = <span class="hljs-string">&quot;node&quot;</span><br><br>    <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry]</span><br>      <span class="hljs-attr">config_path</span> = <span class="hljs-string">&quot;&quot;</span><br><br>      <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.auths]</span><br><br>      <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors]</span><br>        <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;docker.io&quot;]</span><br>          <span class="hljs-attr">endpoint</span>=[<span class="hljs-string">&quot;https://*.mirror.aliyuncs.com&quot;</span>,<span class="hljs-string">&quot;https://*.mirror.swr.myhuaweicloud.com&quot;</span>]<br>        <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;registry.k8s.io&quot;]</span><br>          <span class="hljs-attr">endpoint</span>=[<span class="hljs-string">&quot;https://*.mirror.aliyuncs.com&quot;</span>,<span class="hljs-string">&quot;https://*.mirror.swr.myhuaweicloud.com&quot;</span>]<br>        <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;192.168.10.127:5000&quot;]</span><br>          <span class="hljs-attr">endpoint</span> = [<span class="hljs-string">&quot;https://192.168.10.127:5000&quot;</span>, <span class="hljs-string">&quot;http://192.168.10.127:5000&quot;</span>]<br><br>      <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.configs]</span><br>        <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.configs.&quot;192.168.10.127:5000&quot;.tls]</span><br>          <span class="hljs-attr">insecure_skip_verify</span> = <span class="hljs-literal">true</span><br><br>      <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.headers]</span><br><br>    <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.x509_key_pair_streaming]</span><br>      <span class="hljs-attr">tls_cert_file</span> = <span class="hljs-string">&quot;&quot;</span><br>      <span class="hljs-attr">tls_key_file</span> = <span class="hljs-string">&quot;&quot;</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.internal.v1.opt&quot;]</span><br>    <span class="hljs-attr">path</span> = <span class="hljs-string">&quot;/opt/containerd&quot;</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.internal.v1.restart&quot;]</span><br>    <span class="hljs-attr">interval</span> = <span class="hljs-string">&quot;10s&quot;</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.internal.v1.tracing&quot;]</span><br>    <span class="hljs-attr">sampling_ratio</span> = <span class="hljs-number">1.0</span><br>    <span class="hljs-attr">service_name</span> = <span class="hljs-string">&quot;containerd&quot;</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.metadata.v1.bolt&quot;]</span><br>    <span class="hljs-attr">content_sharing_policy</span> = <span class="hljs-string">&quot;shared&quot;</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.monitor.v1.cgroups&quot;]</span><br>    <span class="hljs-attr">no_prometheus</span> = <span class="hljs-literal">false</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.runtime.v1.linux&quot;]</span><br>    <span class="hljs-attr">no_shim</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">runtime</span> = <span class="hljs-string">&quot;runc&quot;</span><br>    <span class="hljs-attr">runtime_root</span> = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">shim</span> = <span class="hljs-string">&quot;containerd-shim&quot;</span><br>    <span class="hljs-attr">shim_debug</span> = <span class="hljs-literal">false</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.runtime.v2.task&quot;]</span><br>    <span class="hljs-attr">platforms</span> = [<span class="hljs-string">&quot;linux/arm64/v8&quot;</span>]<br>    <span class="hljs-attr">sched_core</span> = <span class="hljs-literal">false</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.service.v1.diff-service&quot;]</span><br>    <span class="hljs-attr">default</span> = [<span class="hljs-string">&quot;walking&quot;</span>]<br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.service.v1.tasks-service&quot;]</span><br>    <span class="hljs-attr">rdt_config_file</span> = <span class="hljs-string">&quot;&quot;</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.snapshotter.v1.aufs&quot;]</span><br>    <span class="hljs-attr">root_path</span> = <span class="hljs-string">&quot;&quot;</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.snapshotter.v1.btrfs&quot;]</span><br>    <span class="hljs-attr">root_path</span> = <span class="hljs-string">&quot;&quot;</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.snapshotter.v1.devmapper&quot;]</span><br>    <span class="hljs-attr">async_remove</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">base_image_size</span> = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">discard_blocks</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">fs_options</span> = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">fs_type</span> = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">pool_name</span> = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">root_path</span> = <span class="hljs-string">&quot;&quot;</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.snapshotter.v1.native&quot;]</span><br>    <span class="hljs-attr">root_path</span> = <span class="hljs-string">&quot;&quot;</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.snapshotter.v1.overlayfs&quot;]</span><br>    <span class="hljs-attr">root_path</span> = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">upperdir_label</span> = <span class="hljs-literal">false</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.snapshotter.v1.zfs&quot;]</span><br>    <span class="hljs-attr">root_path</span> = <span class="hljs-string">&quot;&quot;</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.tracing.processor.v1.otlp&quot;]</span><br>    <span class="hljs-attr">endpoint</span> = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">insecure</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">protocol</span> = <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-section">[proxy_plugins]</span><br><br><span class="hljs-section">[stream_processors]</span><br><br>  <span class="hljs-section">[stream_processors.&quot;io.containerd.ocicrypt.decoder.v1.tar&quot;]</span><br>    <span class="hljs-attr">accepts</span> = [<span class="hljs-string">&quot;application/vnd.oci.image.layer.v1.tar+encrypted&quot;</span>]<br>    <span class="hljs-attr">args</span> = [<span class="hljs-string">&quot;--decryption-keys-path&quot;</span>, <span class="hljs-string">&quot;/etc/containerd/ocicrypt/keys&quot;</span>]<br>    <span class="hljs-attr">env</span> = [<span class="hljs-string">&quot;OCICRYPT_KEYPROVIDER_CONFIG=/etc/containerd/ocicrypt/ocicrypt_keyprovider.conf&quot;</span>]<br>    <span class="hljs-attr">path</span> = <span class="hljs-string">&quot;ctd-decoder&quot;</span><br>    <span class="hljs-attr">returns</span> = <span class="hljs-string">&quot;application/vnd.oci.image.layer.v1.tar&quot;</span><br><br>  <span class="hljs-section">[stream_processors.&quot;io.containerd.ocicrypt.decoder.v1.tar.gzip&quot;]</span><br>    <span class="hljs-attr">accepts</span> = [<span class="hljs-string">&quot;application/vnd.oci.image.layer.v1.tar+gzip+encrypted&quot;</span>]<br>    <span class="hljs-attr">args</span> = [<span class="hljs-string">&quot;--decryption-keys-path&quot;</span>, <span class="hljs-string">&quot;/etc/containerd/ocicrypt/keys&quot;</span>]<br>    <span class="hljs-attr">env</span> = [<span class="hljs-string">&quot;OCICRYPT_KEYPROVIDER_CONFIG=/etc/containerd/ocicrypt/ocicrypt_keyprovider.conf&quot;</span>]<br>    <span class="hljs-attr">path</span> = <span class="hljs-string">&quot;ctd-decoder&quot;</span><br>    <span class="hljs-attr">returns</span> = <span class="hljs-string">&quot;application/vnd.oci.image.layer.v1.tar+gzip&quot;</span><br><br><span class="hljs-section">[timeouts]</span><br>  <span class="hljs-attr">&quot;io.containerd.timeout.bolt.open&quot;</span> = <span class="hljs-string">&quot;0s&quot;</span><br>  <span class="hljs-attr">&quot;io.containerd.timeout.shim.cleanup&quot;</span> = <span class="hljs-string">&quot;5s&quot;</span><br>  <span class="hljs-attr">&quot;io.containerd.timeout.shim.load&quot;</span> = <span class="hljs-string">&quot;5s&quot;</span><br>  <span class="hljs-attr">&quot;io.containerd.timeout.shim.shutdown&quot;</span> = <span class="hljs-string">&quot;3s&quot;</span><br>  <span class="hljs-attr">&quot;io.containerd.timeout.task.state&quot;</span> = <span class="hljs-string">&quot;2s&quot;</span><br><br><span class="hljs-section">[ttrpc]</span><br>  <span class="hljs-attr">address</span> = <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">gid</span> = <span class="hljs-number">0</span><br>  <span class="hljs-attr">uid</span> = <span class="hljs-number"><code class="language-hljs toml"><span class="hljs-attr">disabled_plugins</span> = []<br><span class="hljs-attr">imports</span> = []<br><span class="hljs-attr">oom_score</span> = <span class="hljs-number">0</span><br><span class="hljs-attr">plugin_dir</span> = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attr">required_plugins</span> = []<br><span class="hljs-attr">root</span> = <span class="hljs-string">&quot;/var/lib/containerd&quot;</span><br><span class="hljs-attr">state</span> = <span class="hljs-string">&quot;/run/containerd&quot;</span><br><span class="hljs-attr">temp</span> = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attr">version</span> = <span class="hljs-number">2</span><br><br><span class="hljs-section">[cgroup]</span><br>  <span class="hljs-attr">path</span> = <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-section">[debug]</span><br>  <span class="hljs-attr">address</span> = <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">format</span> = <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">gid</span> = <span class="hljs-number">0</span><br>  <span class="hljs-attr">level</span> = <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">uid</span> = <span class="hljs-number">0</span><br><br><span class="hljs-section">[grpc]</span><br>  <span class="hljs-attr">address</span> = <span class="hljs-string">&quot;/run/containerd/containerd.sock&quot;</span><br>  <span class="hljs-attr">gid</span> = <span class="hljs-number">0</span><br>  <span class="hljs-attr">max_recv_message_size</span> = <span class="hljs-number">16777216</span><br>  <span class="hljs-attr">max_send_message_size</span> = <span class="hljs-number">16777216</span><br>  <span class="hljs-attr">tcp_address</span> = <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">tcp_tls_ca</span> = <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">tcp_tls_cert</span> = <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">tcp_tls_key</span> = <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">uid</span> = <span class="hljs-number">0</span><br><br><span class="hljs-section">[metrics]</span><br>  <span class="hljs-attr">address</span> = <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">grpc_histogram</span> = <span class="hljs-literal">false</span><br><br><span class="hljs-section">[plugins]</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.gc.v1.scheduler&quot;]</span><br>    <span class="hljs-attr">deletion_threshold</span> = <span class="hljs-number">0</span><br>    <span class="hljs-attr">mutation_threshold</span> = <span class="hljs-number">100</span><br>    <span class="hljs-attr">pause_threshold</span> = <span class="hljs-number">0.02</span><br>    <span class="hljs-attr">schedule_delay</span> = <span class="hljs-string">&quot;0s&quot;</span><br>    <span class="hljs-attr">startup_delay</span> = <span class="hljs-string">&quot;100ms&quot;</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;]</span><br>    <span class="hljs-attr">device_ownership_from_security_context</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">disable_apparmor</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">disable_cgroup</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">disable_hugetlb_controller</span> = <span class="hljs-literal">true</span><br>    <span class="hljs-attr">disable_proc_mount</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">disable_tcp_service</span> = <span class="hljs-literal">true</span><br>    <span class="hljs-attr">enable_selinux</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">enable_tls_streaming</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">enable_unprivileged_icmp</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">enable_unprivileged_ports</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">ignore_image_defined_volumes</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">max_concurrent_downloads</span> = <span class="hljs-number">3</span><br>    <span class="hljs-attr">max_container_log_line_size</span> = <span class="hljs-number">16384</span><br>    <span class="hljs-attr">netns_mounts_under_state_dir</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">restrict_oom_score_adj</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">sandbox_image</span> = <span class="hljs-string">&quot;registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.9&quot;</span><br>    <span class="hljs-attr">selinux_category_range</span> = <span class="hljs-number">1024</span><br>    <span class="hljs-attr">stats_collect_period</span> = <span class="hljs-number">10</span><br>    <span class="hljs-attr">stream_idle_timeout</span> = <span class="hljs-string">&quot;4h0m0s&quot;</span><br>    <span class="hljs-attr">stream_server_address</span> = <span class="hljs-string">&quot;127.0.0.1&quot;</span><br>    <span class="hljs-attr">stream_server_port</span> = <span class="hljs-string">&quot;0&quot;</span><br>    <span class="hljs-comment">#systemd_cgroup = false</span><br>    <span class="hljs-attr">tolerate_missing_hugetlb_controller</span> = <span class="hljs-literal">true</span><br>    <span class="hljs-attr">unset_seccomp_profile</span> = <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.cni]</span><br>      <span class="hljs-attr">bin_dir</span> = <span class="hljs-string">&quot;/opt/cni/bin&quot;</span><br>      <span class="hljs-attr">conf_dir</span> = <span class="hljs-string">&quot;/etc/cni/net.d&quot;</span><br>      <span class="hljs-attr">conf_template</span> = <span class="hljs-string">&quot;&quot;</span><br>      <span class="hljs-attr">ip_pref</span> = <span class="hljs-string">&quot;&quot;</span><br>      <span class="hljs-attr">max_conf_num</span> = <span class="hljs-number">1</span><br><br>    <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd]</span><br>      <span class="hljs-attr">default_runtime_name</span> = <span class="hljs-string">&quot;runc&quot;</span><br>      <span class="hljs-attr">disable_snapshot_annotations</span> = <span class="hljs-literal">true</span><br>      <span class="hljs-attr">discard_unpacked_layers</span> = <span class="hljs-literal">false</span><br>      <span class="hljs-attr">ignore_rdt_not_enabled_errors</span> = <span class="hljs-literal">false</span><br>      <span class="hljs-attr">no_pivot</span> = <span class="hljs-literal">false</span><br>      <span class="hljs-attr">snapshotter</span> = <span class="hljs-string">&quot;overlayfs&quot;</span><br><br>      <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.default_runtime]</span><br>        <span class="hljs-attr">base_runtime_spec</span> = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">cni_conf_dir</span> = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">cni_max_conf_num</span> = <span class="hljs-number">0</span><br>        <span class="hljs-attr">container_annotations</span> = []<br>        <span class="hljs-attr">pod_annotations</span> = []<br>        <span class="hljs-attr">privileged_without_host_devices</span> = <span class="hljs-literal">false</span><br>        <span class="hljs-attr">runtime_engine</span> = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">runtime_path</span> = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">runtime_root</span> = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">runtime_type</span> = <span class="hljs-string">&quot;&quot;</span><br><br>        <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.default_runtime.options]</span><br><br>      <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes]</span><br><br>        <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc]</span><br>          <span class="hljs-attr">base_runtime_spec</span> = <span class="hljs-string">&quot;&quot;</span><br>          <span class="hljs-attr">cni_conf_dir</span> = <span class="hljs-string">&quot;&quot;</span><br>          <span class="hljs-attr">cni_max_conf_num</span> = <span class="hljs-number">0</span><br>          <span class="hljs-attr">container_annotations</span> = []<br>          <span class="hljs-attr">pod_annotations</span> = []<br>          <span class="hljs-attr">privileged_without_host_devices</span> = <span class="hljs-literal">false</span><br>          <span class="hljs-attr">runtime_engine</span> = <span class="hljs-string">&quot;&quot;</span><br>          <span class="hljs-attr">runtime_path</span> = <span class="hljs-string">&quot;&quot;</span><br>          <span class="hljs-attr">runtime_root</span> = <span class="hljs-string">&quot;&quot;</span><br>          <span class="hljs-attr">runtime_type</span> = <span class="hljs-string">&quot;io.containerd.runc.v2&quot;</span><br><br>          <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options]</span><br>            <span class="hljs-attr">BinaryName</span> = <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-attr">CriuImagePath</span> = <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-attr">CriuPath</span> = <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-attr">CriuWorkPath</span> = <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-attr">IoGid</span> = <span class="hljs-number">0</span><br>            <span class="hljs-attr">IoUid</span> = <span class="hljs-number">0</span><br>            <span class="hljs-attr">NoNewKeyring</span> = <span class="hljs-literal">false</span><br>            <span class="hljs-attr">NoPivotRoot</span> = <span class="hljs-literal">false</span><br>            <span class="hljs-attr">Root</span> = <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-attr">ShimCgroup</span> = <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-attr">SystemdCgroup</span> = <span class="hljs-literal">true</span><br><br>      <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.untrusted_workload_runtime]</span><br>        <span class="hljs-attr">base_runtime_spec</span> = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">cni_conf_dir</span> = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">cni_max_conf_num</span> = <span class="hljs-number">0</span><br>        <span class="hljs-attr">container_annotations</span> = []<br>        <span class="hljs-attr">pod_annotations</span> = []<br>        <span class="hljs-attr">privileged_without_host_devices</span> = <span class="hljs-literal">false</span><br>        <span class="hljs-attr">runtime_engine</span> = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">runtime_path</span> = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">runtime_root</span> = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">runtime_type</span> = <span class="hljs-string">&quot;&quot;</span><br><br>        <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.untrusted_workload_runtime.options]</span><br><br>    <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.image_decryption]</span><br>      <span class="hljs-attr">key_model</span> = <span class="hljs-string">&quot;node&quot;</span><br><br>    <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry]</span><br>      <span class="hljs-attr">config_path</span> = <span class="hljs-string">&quot;&quot;</span><br><br>      <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.auths]</span><br><br>      <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors]</span><br>        <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;docker.io&quot;]</span><br>          <span class="hljs-attr">endpoint</span>=[<span class="hljs-string">&quot;https://*.mirror.aliyuncs.com&quot;</span>,<span class="hljs-string">&quot;https://*.mirror.swr.myhuaweicloud.com&quot;</span>]<br>        <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;registry.k8s.io&quot;]</span><br>          <span class="hljs-attr">endpoint</span>=[<span class="hljs-string">&quot;https://*.mirror.aliyuncs.com&quot;</span>,<span class="hljs-string">&quot;https://*.mirror.swr.myhuaweicloud.com&quot;</span>]<br>        <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;192.168.10.127:5000&quot;]</span><br>          <span class="hljs-attr">endpoint</span> = [<span class="hljs-string">&quot;https://192.168.10.127:5000&quot;</span>, <span class="hljs-string">&quot;http://192.168.10.127:5000&quot;</span>]<br><br>      <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.configs]</span><br>        <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.configs.&quot;192.168.10.127:5000&quot;.tls]</span><br>          <span class="hljs-attr">insecure_skip_verify</span> = <span class="hljs-literal">true</span><br><br>      <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.headers]</span><br><br>    <span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.x509_key_pair_streaming]</span><br>      <span class="hljs-attr">tls_cert_file</span> = <span class="hljs-string">&quot;&quot;</span><br>      <span class="hljs-attr">tls_key_file</span> = <span class="hljs-string">&quot;&quot;</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.internal.v1.opt&quot;]</span><br>    <span class="hljs-attr">path</span> = <span class="hljs-string">&quot;/opt/containerd&quot;</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.internal.v1.restart&quot;]</span><br>    <span class="hljs-attr">interval</span> = <span class="hljs-string">&quot;10s&quot;</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.internal.v1.tracing&quot;]</span><br>    <span class="hljs-attr">sampling_ratio</span> = <span class="hljs-number">1.0</span><br>    <span class="hljs-attr">service_name</span> = <span class="hljs-string">&quot;containerd&quot;</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.metadata.v1.bolt&quot;]</span><br>    <span class="hljs-attr">content_sharing_policy</span> = <span class="hljs-string">&quot;shared&quot;</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.monitor.v1.cgroups&quot;]</span><br>    <span class="hljs-attr">no_prometheus</span> = <span class="hljs-literal">false</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.runtime.v1.linux&quot;]</span><br>    <span class="hljs-attr">no_shim</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">runtime</span> = <span class="hljs-string">&quot;runc&quot;</span><br>    <span class="hljs-attr">runtime_root</span> = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">shim</span> = <span class="hljs-string">&quot;containerd-shim&quot;</span><br>    <span class="hljs-attr">shim_debug</span> = <span class="hljs-literal">false</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.runtime.v2.task&quot;]</span><br>    <span class="hljs-attr">platforms</span> = [<span class="hljs-string">&quot;linux/arm64/v8&quot;</span>]<br>    <span class="hljs-attr">sched_core</span> = <span class="hljs-literal">false</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.service.v1.diff-service&quot;]</span><br>    <span class="hljs-attr">default</span> = [<span class="hljs-string">&quot;walking&quot;</span>]<br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.service.v1.tasks-service&quot;]</span><br>    <span class="hljs-attr">rdt_config_file</span> = <span class="hljs-string">&quot;&quot;</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.snapshotter.v1.aufs&quot;]</span><br>    <span class="hljs-attr">root_path</span> = <span class="hljs-string">&quot;&quot;</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.snapshotter.v1.btrfs&quot;]</span><br>    <span class="hljs-attr">root_path</span> = <span class="hljs-string">&quot;&quot;</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.snapshotter.v1.devmapper&quot;]</span><br>    <span class="hljs-attr">async_remove</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">base_image_size</span> = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">discard_blocks</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">fs_options</span> = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">fs_type</span> = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">pool_name</span> = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">root_path</span> = <span class="hljs-string">&quot;&quot;</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.snapshotter.v1.native&quot;]</span><br>    <span class="hljs-attr">root_path</span> = <span class="hljs-string">&quot;&quot;</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.snapshotter.v1.overlayfs&quot;]</span><br>    <span class="hljs-attr">root_path</span> = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">upperdir_label</span> = <span class="hljs-literal">false</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.snapshotter.v1.zfs&quot;]</span><br>    <span class="hljs-attr">root_path</span> = <span class="hljs-string">&quot;&quot;</span><br><br>  <span class="hljs-section">[plugins.&quot;io.containerd.tracing.processor.v1.otlp&quot;]</span><br>    <span class="hljs-attr">endpoint</span> = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">insecure</span> = <span class="hljs-literal">false</span><br>    <span class="hljs-attr">protocol</span> = <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-section">[proxy_plugins]</span><br><br><span class="hljs-section">[stream_processors]</span><br><br>  <span class="hljs-section">[stream_processors.&quot;io.containerd.ocicrypt.decoder.v1.tar&quot;]</span><br>    <span class="hljs-attr">accepts</span> = [<span class="hljs-string">&quot;application/vnd.oci.image.layer.v1.tar+encrypted&quot;</span>]<br>    <span class="hljs-attr">args</span> = [<span class="hljs-string">&quot;--decryption-keys-path&quot;</span>, <span class="hljs-string">&quot;/etc/containerd/ocicrypt/keys&quot;</span>]<br>    <span class="hljs-attr">env</span> = [<span class="hljs-string">&quot;OCICRYPT_KEYPROVIDER_CONFIG=/etc/containerd/ocicrypt/ocicrypt_keyprovider.conf&quot;</span>]<br>    <span class="hljs-attr">path</span> = <span class="hljs-string">&quot;ctd-decoder&quot;</span><br>    <span class="hljs-attr">returns</span> = <span class="hljs-string">&quot;application/vnd.oci.image.layer.v1.tar&quot;</span><br><br>  <span class="hljs-section">[stream_processors.&quot;io.containerd.ocicrypt.decoder.v1.tar.gzip&quot;]</span><br>    <span class="hljs-attr">accepts</span> = [<span class="hljs-string">&quot;application/vnd.oci.image.layer.v1.tar+gzip+encrypted&quot;</span>]<br>    <span class="hljs-attr">args</span> = [<span class="hljs-string">&quot;--decryption-keys-path&quot;</span>, <span class="hljs-string">&quot;/etc/containerd/ocicrypt/keys&quot;</span>]<br>    <span class="hljs-attr">env</span> = [<span class="hljs-string">&quot;OCICRYPT_KEYPROVIDER_CONFIG=/etc/containerd/ocicrypt/ocicrypt_keyprovider.conf&quot;</span>]<br>    <span class="hljs-attr">path</span> = <span class="hljs-string">&quot;ctd-decoder&quot;</span><br>    <span class="hljs-attr">returns</span> = <span class="hljs-string">&quot;application/vnd.oci.image.layer.v1.tar+gzip&quot;</span><br><br><span class="hljs-section">[timeouts]</span><br>  <span class="hljs-attr">&quot;io.containerd.timeout.bolt.open&quot;</span> = <span class="hljs-string">&quot;0s&quot;</span><br>  <span class="hljs-attr">&quot;io.containerd.timeout.shim.cleanup&quot;</span> = <span class="hljs-string">&quot;5s&quot;</span><br>  <span class="hljs-attr">&quot;io.containerd.timeout.shim.load&quot;</span> = <span class="hljs-string">&quot;5s&quot;</span><br>  <span class="hljs-attr">&quot;io.containerd.timeout.shim.shutdown&quot;</span> = <span class="hljs-string">&quot;3s&quot;</span><br>  <span class="hljs-attr">&quot;io.containerd.timeout.task.state&quot;</span> = <span class="hljs-string">&quot;2s&quot;</span><br><br><span class="hljs-section">[ttrpc]</span><br>  <span class="hljs-attr">address</span> = <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">gid</span> = <span class="hljs-number">0</span><br>  <span class="hljs-attr">uid</span> = <span class="hljs-number">0</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>
<p>重启containerd</p>
<figure class="highlight bash"><table><tr><td class="code"><pre class="line-numbers language-hljs bash"><span class="hljs-built_in"><code class="language-hljs bash"><span class="hljs-built_in">sudo</span> systemctl restart containerd<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>
<p>此外，还建议为containerd配置代理（需要事先已经配置好电脑代理）：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre class="line-numbers language-hljs bash"><code class="language-hljs bash">vim /lib/systemd/system/containerd.service<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>
<p>增加以下内容（根据自己的代理进行调整，笔者使用的是clash）：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre class="line-numbers language-hljs containerd.service"><code class="language-hljs containerd.service">Environment="HTTP_PROXY=http://127.0.0.1:7890"<br>Environment="HTTPS_PROXY=http://127.0.0.1:7890"<br>Environment="NO_PROXY =10.96.0.0/16,127.0.0.1,192.168.0.0/16,localhost"<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>
<h2 id="安装runc"><a href="#安装runc" class="headerlink" title="安装runc"></a>安装runc</h2><figure class="highlight bash"><table><tr><td class="code"><pre class="line-numbers language-hljs bash">wget -c https://github.com/opencontainers/runc/releases/download/v1.1.12/runc.amd64<br><br><span class="hljs-built_in"><code class="language-hljs bash">wget -c https://github.com/opencontainers/runc/releases/download/v1.1.12/runc.amd64<br><br><span class="hljs-built_in">sudo</span> install -m 755 runc.amd64 /usr/local/sbin/runc<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>
<p>我在操作的过程中发现还需要把&#x2F;usr&#x2F;local&#x2F;sbin&#x2F;加入到环境变量中，这个请自行搜索方法。</p>
<h2 id="安装CNI-plugins"><a href="#安装CNI-plugins" class="headerlink" title="安装CNI plugins"></a>安装CNI plugins</h2><figure class="highlight bash"><table><tr><td class="code"><pre class="line-numbers language-hljs bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mkdir</span> -p /opt/cni/bin<br><br><span class="hljs-built_in"><code class="language-hljs bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mkdir</span> -p /opt/cni/bin<br><br><span class="hljs-built_in">sudo</span> tar Cxzvf /opt/cni/bin cni-plugins-linux-amd64-v1.4.1.tgz<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>
<h1 id="安装客户端"><a href="#安装客户端" class="headerlink" title="安装客户端"></a>安装客户端</h1><p>因为是配合k8s使用，所以选择安装<code>crictl</code>。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre class="line-numbers language-hljs bash">VERSION=<span class="hljs-string">&quot;v1.30.0&quot;</span><br><br>wget https://github.com/kubernetes-sigs/cri-tools/releases/download/<span class="hljs-variable">$VERSION</span>/crictl-<span class="hljs-variable">$VERSION</span>-linux-amd64.tar.gz<br><br><span class="hljs-built_in">sudo</span> tar zxvf crictl-<span class="hljs-variable"><code class="language-hljs bash">VERSION=<span class="hljs-string">&quot;v1.30.0&quot;</span><br><br>wget https://github.com/kubernetes-sigs/cri-tools/releases/download/<span class="hljs-variable">$VERSION</span>/crictl-<span class="hljs-variable">$VERSION</span>-linux-amd64.tar.gz<br><br><span class="hljs-built_in">sudo</span> tar zxvf crictl-<span class="hljs-variable">$VERSION</span>-linux-amd64.tar.gz -C /usr/local/bin<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>
<p>配置：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre class="line-numbers language-hljs bash"><span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string"><code class="language-hljs bash"><span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">EOF | sudo tee /etc/crictl.yaml runtime-endpoint: unix:///run/containerd/containerd.sock image-endpoint: unix:///run/containerd/containerd.sock timeout: 2 debug: true pull-image-on-create: false EOF</span><br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>


<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><ul>
<li>容器运行时containerd：<a target="_blank" rel="noopener" href="https://demonlee.tech/archives/2212001">https://demonlee.tech/archives/2212001</a></li>
<li>Containerd配置国内镜像源：<a target="_blank" rel="noopener" href="https://juejin.cn/post/7312330825206693939">https://juejin.cn/post/7312330825206693939</a></li>
<li>简述关于containerd设置代理：<a target="_blank" rel="noopener" href="https://blog.51cto.com/u_15343792/5142108">https://blog.51cto.com/u_15343792/5142108</a></li>
</ul>
</p></div><div class="share"><span>Share</span>&nbsp;<span class="soc"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></span><span class="soc"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></span><span class="soc"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=https://shemol.tech/2024/06/09/安装容器运行时：containerd/%20Shemol's Blog%20安装容器运行时：containerd"></a></span></div><div class="pagination"><p class="clearfix"><span class="pre pagbuttons"><a role="navigation" href="/2024/06/10/k8s%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E4%BB%A5%E5%8F%8Akubeedge%E9%83%A8%E7%BD%B2%E5%89%8D%E5%87%86%E5%A4%87/" title="k8s集群安装以及kubeedge部署前准备"><i class="fa fa-angle-double-left"></i>&nbsp;Previous post: k8s集群安装以及kubeedge部署前准备</a></span><span>&nbsp;</span><span class="next pagbuttons"><a role="navigation" href="/2024/05/07/%E8%BF%91%E5%86%B5/" title="近况">Next post: 近况&nbsp;<i class="fa fa-angle-double-right"></i></a></span></p></div></div></div></div><div class="visible-xs site-bottom-footer"><footer><p>&copy;&nbsp;2024&nbsp;<a target="_blank" href="https://shemol.tech" rel="noopener noreferrer">Shemol</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div></div><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/google-analytics.js"></script><script src="/js/typography.js"></script></body></html>